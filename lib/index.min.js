"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_queryString=require("query-string"),_queryString2=_interopRequireDefault(_queryString),_isomorphicFetch=require("isomorphic-fetch"),_isomorphicFetch2=_interopRequireDefault(_isomorphicFetch),_CockpitRealTime=require("./CockpitRealTime"),_CockpitRealTime2=_interopRequireDefault(_CockpitRealTime),defaultOptions={mode:"cors",cache:"default"},CockpitSDK=function(){function e(t){var n=t.host,i=t.accessToken,o=t.lang,a=t.websocket;_classCallCheck(this,e),this.host=n,this.lang=o,this.accessToken=i,this.websocket=a,this.queryParams={lang:this.lang,token:this.accessToken},a&&(this.websocket=new _CockpitRealTime2.default({host:a}))}return _createClass(e,[{key:"fetchData",value:function(e,t,n){var i=Object.assign({},t,defaultOptions),o=""+this.host+e+"?"+_queryString2.default.stringify(this.queryParams)+"&"+_queryString2.default.stringify(n);return(0,_isomorphicFetch2.default)(o,i).then(function(e){return e.json()})}},{key:"fetchDataText",value:function(e,t,n){var i=Object.assign({},t,defaultOptions),o=""+this.host+e+"?"+_queryString2.default.stringify(this.queryParams)+"&"+_queryString2.default.stringify(n);return(0,_isomorphicFetch2.default)(o,i).then(function(e){return e.text()})}},{key:"collectionSchema",value:function(e){return this.fetchData("/api/collections/collection/"+e,{method:"GET"})}},{key:"collectionList",value:function(e){return this.fetchData("/api/collections/listCollections",{method:"GET"})}},{key:"collectionGet",value:function(e,t){return this.fetchData("/api/collections/get/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}},{key:"collection",value:function(e,t){var n=this,i={save:function(e,t){return console.warn("collection.().save() not implemented yet"),i},remove:function(e,t){return console.warn("collection.().remove() not implemented yet"),i},get:function(o,a){return n.collectionGet(e,t).then(o).catch(a),i},schema:function(o,a){return n.collectionSchema(e,t).then(o).catch(a),i},watch:function(o,a){var r=function(){return n.collectionGet(e,t).then(o).catch(a)};return n.websocket.on(_CockpitRealTime2.default.events.COLLECTIONS_SAVE_AFTER,r,a),n.websocket.on(_CockpitRealTime2.default.events.COLLECTIONS_SAVE_AFTER+"."+e,r,a),r(),i},on:function(e,t,o){var a={save:_CockpitRealTime2.default.events.COLLECTIONS_SAVE_AFTER,preview:_CockpitRealTime2.default.events.COLLECTIONS_PREVIEW};return n.websocket.on(a[e],t,o),i}};return i}},{key:"regionGet",value:function(e){return this.fetchDataText("/api/regions/get/"+e,{method:"GET"})}},{key:"regionList",value:function(){return this.fetchDataText("/api/regions/listRegions",{method:"GET"})}},{key:"regionData",value:function(e){return this.fetchData("/api/regions/data/"+e,{method:"GET"})}},{key:"region",value:function(e){var t=this,n={data:function(i,o){return t.regionData(e).then(i).catch(o),n},get:function(i,o){return t.regionGet(e).then(i).catch(o),n}};return n}},{key:"assets",value:function(e){return this.fetchData("/api/cockpit/assets",{method:"GET",headers:{"Content-Type":"application/json"}},e)}},{key:"image",value:function(e,t){var n=t.width,i=t.height,o=t.quality;return this.fetchDataText("/api/cockpit/image",{method:"GET"},{src:e,w:n,h:i,q:o,d:1})}},{key:"authUser",value:function(e,t){return this.fetchData("/api/cockpit/authUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:e,password:t})})}},{key:"listUsers",value:function(e){return this.fetchData("/api/cockpit/listUsers",{method:"GET",headers:{"Content-Type":"application/json"}},e)}}]),e}();CockpitSDK.events={SAVE:"save",PREVIEW:"preview"},module.exports=CockpitSDK;