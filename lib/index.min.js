"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_queryString=require("query-string"),_queryString2=_interopRequireDefault(_queryString),_isomorphicFetch=require("isomorphic-fetch"),_isomorphicFetch2=_interopRequireDefault(_isomorphicFetch),_CockpitRealTime=require("./CockpitRealTime"),_CockpitRealTime2=_interopRequireDefault(_CockpitRealTime),defaultOptions={mode:"cors",cache:"default"},CockpitSDK=function(){function e(t){var i=t.host,n=t.accessToken,a=t.lang,r=t.websocket;_classCallCheck(this,e),this.host=i,this.lang=a,this.accessToken=n,this.websocket=r,this.queryParams={lang:this.lang,token:this.accessToken},r&&(this.websocket=new _CockpitRealTime2.default({host:r}))}return _createClass(e,[{key:"fetchData",value:function(e,t){var i=Object.assign({},t,defaultOptions),n=""+this.host+e+"?"+_queryString2.default.stringify(this.queryParams);return(0,_isomorphicFetch2.default)(n,i).then(function(e){return e.json()})}},{key:"fetchDataText",value:function(e,t,i){var n=Object.assign({},t,defaultOptions),a=""+this.host+e+"?"+_queryString2.default.stringify(this.queryParams)+"&"+_queryString2.default.stringify(i);return(0,_isomorphicFetch2.default)(a,n).then(function(e){return e.text()})}},{key:"collectionSchema",value:function(e){return this.fetchData("/api/collections/collection/"+e,{method:"GET"})}},{key:"collectionEntries",value:function(e,t){return this.fetchData("/api/collections/get/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}},{key:"collection",value:function(e,t){var i=this,n={get:function(a,r){var o=function(){return i.collectionEntries(e,t).then(a).catch(r)};return i.websocket.on(_CockpitRealTime2.default.events.COLLECTIONS_SAVE_AFTER,o,r),i.websocket.on(_CockpitRealTime2.default.events.COLLECTIONS_SAVE_AFTER+"."+e,o,r),o(),n},on:function(e,t,a){var r={save:_CockpitRealTime2.default.events.COLLECTIONS_SAVE_AFTER,preview:_CockpitRealTime2.default.events.COLLECTIONS_PREVIEW};return i.websocket.on(r[e],t,a),n}};return n}},{key:"regionRenderedTemplate",value:function(e){return this.fetchData("/api/regions/get/"+e,{method:"GET"})}},{key:"regionFormData",value:function(e){return this.fetchData("/api/regions/data/"+e,{method:"GET"})}},{key:"assets",value:function(){return this.fetchData("/api/cockpit/assets",{method:"GET"})}},{key:"image",value:function(e,t){var i=t.width,n=t.height;return this.fetchDataText("/api/cockpit/image",{method:"GET"},{src:e,w:i,h:n,d:1})}}]),e}();CockpitSDK.events={SAVE:"save",PREVIEW:"preview"},module.exports=CockpitSDK;