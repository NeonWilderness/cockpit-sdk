"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,i){try{var o=t[a](i),u=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}return n("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_queryString=require("query-string"),_queryString2=_interopRequireDefault(_queryString),_isomorphicFetch=require("isomorphic-fetch"),_isomorphicFetch2=_interopRequireDefault(_isomorphicFetch),_CockpitRealTime=require("./CockpitRealTime"),_CockpitRealTime2=_interopRequireDefault(_CockpitRealTime),defaultOptions={mode:"cors",cache:"default"},CockpitSDK=function(){function e(t){var r=t.host,n=t.accessToken,a=t.lang,i=t.websocket;_classCallCheck(this,e),this.host=r,this.lang=a,this.accessToken=n,this.websocket=i,this.queryParams={lang:this.lang,token:this.accessToken},i&&(this.websocket=new _CockpitRealTime2.default({host:i}))}return _createClass(e,[{key:"fetchData",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,a,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.assign({},r,defaultOptions),a=""+this.host+t+"?"+_queryString2.default.stringify(this.queryParams),e.next=4,(0,_isomorphicFetch2.default)(a,n);case 4:return i=e.sent,e.next=7,i.json();case 7:return o=e.sent,e.abrupt("return",o);case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchDataText",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var a,i,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object.assign({},r,defaultOptions),i=""+this.host+t+"?"+_queryString2.default.stringify(this.queryParams)+"&"+_queryString2.default.stringify(n),e.next=4,(0,_isomorphicFetch2.default)(i,a);case 4:return o=e.sent,e.next=7,o.text();case 7:return u=e.sent,e.abrupt("return",u);case 9:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"collectionSchema",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchData("/api/collections/collection/"+t,{method:"GET"}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"collectionEntries",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchData("/api/collections/get/"+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"collection",value:function(e,t){var r=this,n={get:function(a,i){var o=function(){return r.collectionEntries(e,t).then(a).catch(i)};return r.websocket.on(_CockpitRealTime2.default.events.COLLECTIONS_SAVE_AFTER,o,i),r.websocket.on(_CockpitRealTime2.default.events.COLLECTIONS_SAVE_AFTER+"."+e,o,i),o(),n},on:function(e,t,a){var i={save:_CockpitRealTime2.default.events.COLLECTIONS_SAVE_AFTER,preview:_CockpitRealTime2.default.events.COLLECTIONS_PREVIEW};return r.websocket.on(i[e],t,a),n}};return n}},{key:"regionRenderedTemplate",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchData("/api/regions/get/"+t,{method:"GET"}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"regionFormData",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchData("/api/regions/data/"+t,{method:"GET"}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"assets",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchData("/api/cockpit/assets",{method:"GET"}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"image",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n=r.width,a=r.height;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchDataText("/api/cockpit/image",{method:"GET"},{src:t,w:n,h:a,d:1}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}();CockpitSDK.events={SAVE:"save",PREVIEW:"preview"},module.exports=CockpitSDK;